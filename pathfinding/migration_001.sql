CREATE TYPE poc AS
(
    name  TEXT,
    phone TEXT,
    email TEXT
);

DROP TABLE IF EXISTS pois;
CREATE TABLE pois
(
    id             BIGINT PRIMARY KEY NOT NULL,
    name           TEXT               NOT NULL,
    description    TEXT,
    rrule          TEXT               NOT NULL,
    pocs           poc[],
    coords         NUMERIC(10, 7)[],
    closest_coords NUMERIC(10, 7)[],
    document       TSVECTOR GENERATED ALWAYS AS (to_tsvector('english', name || ' ' || coalesce(description, ''))) STORED
);
CREATE INDEX pois_search_idx ON pois USING GIN (document);

SELECT unnest(pois.closest_coords)
FROM pois
WHERE id = 1866338258;

INSERT INTO pois (id, name, description, rrule, coords, closest_coords, pocs)
VALUES (1866330465, 'Suprabha', '', '8:30am to 6:30pm', '{13.0059951, 74.794973200000001}',
        '{13.0060395, 74.794916599999993}', ARRAY [('John Doe', '', '')::poc]),
       (1866337511, 'Ganesh', '', '8:30am to 6:30pm', '{13.008756200000001, 74.794132899999994}',
        '{13.0060395, 74.794916599999993}', ARRAY [('John Doe', '', '')::poc]),
       (1866338258, 'Iyengar Bakery', '', '8:30am to 6:30pm', '{13.0085877, 74.794130199999998}',
        '{13.0060395, 74.794916599999993}', ARRAY [('John Doe', '', '')::poc]),
       (1866338471, 'Students Cooperative', '', '8:30am to 6:30pm', '{13.0086216, 74.794132300000001}',
        '{13.0060395, 74.794916599999993}', ARRAY [('John Doe', '', '')::poc]),
       (1866340008, 'Canara Bank', '', '8:30am to 6:30pm', '{13.008676899999999, 74.794134499999998}',
        '{13.0060395, 74.794916599999993}', ARRAY [('John Doe', '', '')::poc]),
       (1866342501, 'Amul Shreyas', '', '8:30am to 6:30pm', '{13.0089556, 74.796761399999994}',
        '{13.0091594, 74.796761399999994}', ARRAY [('John Doe', '', '')::poc]),
       (1866343117, 'Sports Complex', '', '8:30am to 6:30pm', '{13.008984399999999, 74.797061400000004}',
        '{13.0091594, 74.796761399999994}', ARRAY [('John Doe', '', '')::poc]),
       (3365376156, 'NITK Guest House Bus Stop', '', '8:30am to 6:30pm', '{13.011668200000001, 74.792564400000003}',
        '{13.0091594, 74.796761399999994}', ARRAY [('John Doe', '', '')::poc]),
       (3655380894, 'Mega Hostel - Tower 1', '', '8:30am to 6:30pm', '{13.0076403, 74.794782100000006}',
        '{13.0091594, 74.796761399999994}', ARRAY [('John Doe', '', '')::poc]),
       (3655381317, 'Silver Jubliee Auditorium', '', '8:30am to 6:30pm', '{13.008784500000001, 74.795682900000003}',
        '{13.0091594, 74.796761399999994}', ARRAY [('John Doe', '', '')::poc]),
       (3655381445, 'Post Office', '', '8:30am to 6:30pm', '{13.0089203, 74.793385599999993}',
        '{13.0091594, 74.796761399999994}', ARRAY [('John Doe', '', '')::poc]),
       (3655381451, 'Department of Chemistry and Physics', '', '8:30am to 6:30pm',
        '{13.008929200000001, 74.794962799999993}', '{13.0091594, 74.796761399999994}',
        ARRAY [('John Doe', '', '')::poc]),
       (3655381488, 'Central Computer Centrre', '', '8:30am to 6:30pm', '{13.009346600000001, 74.795645800000003}',
        '{13.0091594, 74.796761399999994}', ARRAY [('John Doe', '', '')::poc]),
       (3655381507, 'Health Care Center', '', '8:30am to 6:30pm', '{13.0094806, 74.796337800000003}',
        '{13.0091594, 74.796761399999994}', ARRAY [('John Doe', '', '')::poc]),
       (3655381894, 'Department of Information Technology', '', '8:30am to 6:30pm',
        '{13.011169600000001, 74.792255800000007}', '{13.0091594, 74.796761399999994}',
        ARRAY [('John Doe', '', '')::poc]),
       (4274303392, 'NITK Central Library', '', '8:30am to 6:30pm', '{13.009928, 74.794047300000003}',
        '{13.0091594, 74.796761399999994}', ARRAY [('John Doe', '', '')::poc]),
       (4447552231, 'Nescafe', '', '8:30am to 6:30pm', '{13.0074646, 74.796875299999996}',
        '{13.0091594, 74.796761399999994}', ARRAY [('John Doe', '', '')::poc]),
       (4447552232, 'Sri Sai Hospitality Night Canteen', '', '8:30am to 6:30pm',
        '{13.007958500000001, 74.796200499999998}', '{13.0091594, 74.796761399999994}',
        ARRAY [('John Doe', '', '')::poc]),
       (4447552234, 'Health Subcenter', '', '8:30am to 6:30pm', '{13.0094356, 74.796130899999994}',
        '{13.0091594, 74.796761399999994}', ARRAY [('John Doe', '', '')::poc]),
       (4447580805, 'Tripthi Night Canteen', '', '8:30am to 6:30pm', '{13.007282500000001, 74.793844000000007}',
        '{13.0091594, 74.796761399999994}', ARRAY [('John Doe', '', '')::poc]),
       (4447580833, 'New Girls Hostel Block', '', '8:30am to 6:30pm', '{13.0131698, 74.796035700000004}',
        '{13.0091594, 74.796761399999994}', ARRAY [('John Doe', '', '')::poc]),
       (4447580834, 'Nandini', '', '8:30am to 6:30pm', '{13.0125005, 74.796514999999999}',
        '{13.0091594, 74.796761399999994}', ARRAY [('John Doe', '', '')::poc]),
       (4447580835, 'Crumbs', '', '8:30am to 6:30pm', '{13.012689200000001, 74.796513000000004}',
        '{13.0091594, 74.796761399999994}', ARRAY [('John Doe', '', '')::poc]),
       (4447580836, 'NITK English Medium School', '', '8:30am to 6:30pm', '{13.015090199999999, 74.794500299999996}',
        '{13.0091594, 74.796761399999994}', ARRAY [('John Doe', '', '')::poc]),
       (4543009483, 'Reddy''s Store', '', '8:30am to 6:30pm', '{13.012727699999999, 74.793173800000005}', '{13.0091594,
        74.796761399999994}', ARRAY [('John Doe', '', '')::poc]),
       (4543009486, 'Mega Mess', '', '8:30am to 6:30pm', '{13.007686700000001,
        74.795458499999995}', '{13.0091594,
        74.796761399999994}', ARRAY [('John Doe', '', '')::poc]),
       (5269747333, 'Sahyadri (7th Block)', '', '8:30am to 6:30pm', '{13.0077005,
        74.796362200000004}', '{13.0091594,
        74.796761399999994}', ARRAY [('John Doe', '', '')::poc]),
       (5269747339, 'Sports Ground', '', '8:30am to 6:30pm', '{13.009212,
        74.796723}', '{13.0091594,
        74.796761399999994}', ARRAY [('John Doe', '', '')::poc]),
       (5338374874, 'Statue of U. S. Mallya', '', '8:30am to 6:30pm', '{13.010801600000001,
        74.793161499999997}', '{13.0091594,
        74.796761399999994}', ARRAY [('John Doe', '', '')::poc]),
       (6269599012, 'Yennar Electricals', '', '8:30am to 6:30pm', '{13.0087069,
        74.794101499999996}', '{13.0091594,
        74.796761399999994}', ARRAY [('John Doe', '', '')::poc]),
       (8187929876, 'Canara Bank ATM', '', '8:30am to 6:30pm', '{13.008657299999999,
        74.794134700000001}', '{13.0091594,
        74.796761399999994}', ARRAY [('John Doe', '', '')::poc]),
       (11540257292, 'Old Sports Complex', '', '8:30am to 6:30pm', '{13.0091223,
        74.797141600000003}', '{13.0091594,
        74.796761399999994}', ARRAY [('John Doe', '', '')::poc]),
       (11540257293, 'NITK Old Gym', '', '8:30am to 6:30pm', '{13.007202100000001,
        74.794823899999997}', '{13.0091594,
        74.796761399999994}', ARRAY [('John Doe', '', '')::poc]),
       (11540257294, 'Trishul (8th Block)', '', '8:30am to 6:30pm', '{13.0074352,
        74.794156999999998}', '{13.0091594,
        74.796761399999994}', ARRAY [('John Doe', '', '')::poc]),
       (11543452860, 'NITK Main Building', '', '8:30am to 6:30pm', '{13.0108333,
        74.794260399999999}', '{13.0091594,
        74.796761399999994}', ARRAY [('John Doe', '', '')::poc]),
       (11543452861, 'NITK Main Building', '', '8:30am to 6:30pm', '{13.0108315,
        74.794422100000006}', '{13.0091594,
        74.796761399999994}', ARRAY [('John Doe', '', '')::poc]),
       (11543452862, 'Central Library', '', '8:30am to 6:30pm', '{13.009998599999999,
        74.794107699999998}', '{13.0091594,
        74.796761399999994}', ARRAY [('John Doe', '', '')::poc]),
       (11543452863, 'Lecture Hall Complex - A (LHC -A)', '', '8:30am to 6:30pm', '{13.009613999999999,
        74.793868000000003}', '{13.0091594,
        74.796761399999994}', ARRAY [('John Doe', '', '')::poc]),
       (11745552206, 'Lecture Hall Complex C (LHC-C)', '', '8:30am to 6:30pm', '{13.010400600000001,
        74.792515199999997}', '{13.0091594,
        74.796761399999994}', ARRAY [('John Doe', '', '')::poc]),
       (11745552207, 'Department of Electrical and Electronics', '', '8:30am to 6:30pm', '{13.010986000000001,
        74.792424400000002}', '{13.0091594,
        74.796761399999994}', ARRAY [('John Doe', '', '')::poc]),
       (11745552208, 'Department of Electronics and Communication', '', '8:30am to 6:30pm', '{13.011351400000001,
        74.792111500000004}', '{13.0091594,
        74.796761399999994}', ARRAY [('John Doe', '', '')::poc]),
       (11745552209, 'Lecture Hall Complex - B (LHC -B)', '', '8:30am to 6:30pm', '{13.009326099999999,
        74.794457100000002}', '{13.0091594,
        74.796761399999994}', ARRAY [('John Doe', '', '')::poc]),
       (11745552211, 'Gurushri Computers', '', '8:30am to 6:30pm', '{13.0085646,
        74.7941328}', '{13.0091594,
        74.796761399999994}', ARRAY [('John Doe', '', '')::poc]),
       (11751135834, 'CIDS', '', '8:30am to 6:30pm', '{13.0094359,
        74.795122500000005}', '{13.0091594,
        74.796761399999994}', ARRAY [('John Doe', '', '')::poc]),
       (11751160032, 'Pavilion', '', '8:30am to 6:30pm', '{13.011051999999999,
        74.794639099999998}', '{13.0091594,
        74.796761399999994}', ARRAY [('John Doe', '', '')::poc]),
       (11752552234, 'CSD', '', '8:30am to 6:30pm', '{13.011016100000001,
        74.794958300000005}', '{13.0091594,
        74.796761399999994}', ARRAY [('John Doe', '', '')::poc]),
       (12008903628, 'Nescafe', '', '8:30am to 6:30pm', '{13.0116079,
        74.791813899999994}', '{13.0091594, 74.796761399999994}', ARRAY [('John Doe', '', '')::poc]);

