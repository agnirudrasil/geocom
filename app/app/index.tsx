import { StyleSheet } from "react-native";

import { View } from "@/components/Themed";
import MapView, { Geojson } from "react-native-maps";
import { useState } from "react";
import { useTheme, H2, YStack, Button, YGroup, Separator } from "tamagui";
import BottomSheet, { BottomSheetView } from "@gorhom/bottom-sheet";
import { MapPin, Navigation, PlusCircle } from "@tamagui/lucide-icons";
import features from "./nitk.geo.json";

export default function TabOneScreen() {
  const [position, setPosition] = useState(1);
  const [open, setOpen] = useState(true);
  const theme = useTheme();

  const [region, setRegion] = useState({
    latitude: 13.01086121451261,
    longitude: 74.79429826652435,
    latitudeDelta: 0.016103154323193536,
    longitudeDelta: 0.009563403566900774,
  });

  // const markers_py = [
  //   [13.0124929, 74.7930409],
  //   [13.0124924, 74.7930925],
  //   [13.0124815, 74.7941749],
  //   [13.0120704, 74.7941659],
  //   [13.0117955, 74.7941598],
  //   [13.0115564, 74.7941763],
  //   [13.0114864, 74.7941763],
  //   [13.0114761, 74.7943094],
  //   [13.0114735, 74.7943671],
  //   [13.0114813, 74.7944301],
  //   [13.0114238, 74.7944391],
  //   [13.011368, 74.7944376],
  //   [13.0112778, 74.7944439],
  //   [13.0112548, 74.7944556],
  //   [13.0110175, 74.7944627],
  //   [13.0108711, 74.7944646],
  //   [13.0106072, 74.7944681],
  //   [13.0105006, 74.794474],
  //   [13.0104457, 74.7945276],
  //   [13.0103516, 74.7946966],
  //   [13.0102784, 74.7948415],
  //   [13.0102053, 74.7950104],
  //   [13.0101881, 74.7950305],
  //   [13.0101532, 74.7950433],
  //   [13.0098255, 74.7950354],
  //   [13.0095455, 74.7950478],
  //   [13.009143, 74.7950426],
  //   [13.0091495, 74.7954087],
  //   [13.009154, 74.7958513],
  //   [13.009155, 74.7959545],
  //   [13.0091351, 74.7965667],
  //   [13.0089608, 74.7966621],
  //   [13.0088534, 74.7966654],
  //   [13.008781, 74.7966707],
  //   [13.0085981, 74.7967029],
  //   [13.0083509, 74.7968071],
  //   [13.0083054, 74.7968263],
  //   [13.0081799, 74.7968987],
  //   [13.0081069, 74.7969243],
  //   [13.0080513, 74.7969438],
  //   [13.0079499, 74.7969738],
  //   [13.0077878, 74.7969855],
  //   [13.0076886, 74.7969926],
  //   [13.0075553, 74.7969845],
  //   [13.0074064, 74.7969336],
  //   [13.0073854, 74.7969899],
  //   [13.0073358, 74.7970543],
  //   [13.0072809, 74.7970999],
  // ];

  const markers_cpp = {
    path: [
      [13.0124083, 74.7917972],
      [13.0124162, 74.7920627],
      [13.012458, 74.7923068],
      [13.0124841, 74.792583],
      [13.0119876, 74.7926286],
      [13.011906, 74.7926254],
      [13.011559, 74.7926105],
      [13.0109731, 74.792608],
      [13.010857, 74.792605],
      [13.0108556, 74.7925692],
      [13.0112088, 74.7925753],
      [13.0112148, 74.7932623],
      [13.011053, 74.7932501],
      [13.011053, 74.7931937],
      [13.0109788, 74.7932026],
      [13.010979, 74.7931713],
      [13.0109799, 74.793025],
      [13.0107679, 74.7930227],
      [13.010634, 74.7930249],
      [13.0097229, 74.793027],
      [13.009125, 74.7930145],
      [13.0091259, 74.7930979],
      [13.0091381, 74.7942991],
      [13.0089059, 74.7942991],
      [13.0085144, 74.7942997],
      [13.0082519, 74.7943141],
      [13.0082818, 74.7944633],
      [13.0082923, 74.7946108],
      [13.0082452, 74.7945679],
      [13.0081904, 74.7945223],
      [13.0081433, 74.7944901],
      [13.0080832, 74.7944928],
      [13.0080362, 74.7945142],
      [13.0079865, 74.7945357],
      [13.0079264, 74.7945679],
      [13.0078663, 74.7946001],
      [13.0078219, 74.7946027],
      [13.0077827, 74.794533],
      [13.0077592, 74.7944686],
      [13.0077095, 74.7944284],
      [13.0076755, 74.7943882],
      [13.0075919, 74.7943748],
      [13.0075213, 74.7943667],
      [13.0074508, 74.7943667],
      [13.0074273, 74.7944043],
      [13.0074482, 74.7945079],
      [13.0074896, 74.7946171],
      [13.0075249, 74.7947023],
      [13.0075341, 74.7947685],
      [13.0075124, 74.7948188],
      [13.0074839, 74.7948514],
      [13.0074377, 74.7948817],
      [13.0073802, 74.7949005],
      [13.0073227, 74.7949058],
      [13.0072731, 74.7948978],
      [13.0071999, 74.7949139],
      [13.0071424, 74.7949461],
      [13.0070614, 74.7949836],
      [13.0070143, 74.7949943],
      [13.0069699, 74.7949863],
      [13.0069281, 74.7949622],
      [13.0068941, 74.7949032],
      [13.0068628, 74.7948388],
      [13.0068157, 74.794769],
      [13.0067832, 74.7947335],
      [13.0067739, 74.7947449],
      [13.0066592, 74.7948122],
      [13.0066093, 74.7948415],
      [13.0065938, 74.7948547],
      [13.0065622, 74.7948817],
      [13.0065204, 74.7949568],
      [13.0065101, 74.7949678],
      [13.0063976, 74.7950882],
      [13.0062826, 74.7951767],
      [13.0062133, 74.7952292],
      [13.0062721, 74.795335],
      [13.006418, 74.7955732],
      [13.0066171, 74.7958875],
      [13.0066831, 74.7960021],
      [13.0067704, 74.7961602],
      [13.0069185, 74.7964227],
      [13.0069429, 74.7964535],
      [13.0069568, 74.7964776],
      [13.0070922, 74.7967024],
      [13.0072157, 74.7968252],
      [13.0071785, 74.7969438],
      [13.0071758, 74.797043],
      [13.0072177, 74.797094],
      [13.0072809, 74.7970999],
    ],
  };

  return (
    <View>
      <MapView initialRegion={region} style={styles.map}>
        <Geojson
          strokeWidth={3}
          strokeColor="green"
          geojson={features}
          // geojson={{
          //   features: [
          //     {
          //       properties: {
          //         type: "way",
          //       },
          //       type: "Feature",
          //       geometry: {
          //         type: "LineString",
          //         coordinates: markers_cpp.path.map((marker) =>
          //           marker.reverse()
          //         ),
          //       },
          //     },
          //   ],
          // }}
        />
      </MapView>
      <BottomSheet
        backgroundStyle={{
          backgroundColor: theme.background.val,
        }}
        handleIndicatorStyle={{
          backgroundColor: theme.accentColor.val,
        }}
        snapPoints={["15%", "50%", "80%"]}
        index={position}
        onChange={(index) => setPosition(index)}
        enableDynamicSizing={false}
      >
        <BottomSheetView>
          <YStack padding="$3" gap="$4">
            <H2>Directions</H2>
            {position > 0 && (
              <>
                <YGroup
                  borderRadius="$2"
                  padding="$1.5"
                  paddingStart="$2"
                  backgroundColor="$accentBackground"
                  separator={<Separator borderColor="$accentColor" />}
                >
                  <YGroup.Item>
                    <Button
                      chromeless
                      jc="flex-start"
                      icon={Navigation}
                      width="100%"
                    >
                      From
                    </Button>
                  </YGroup.Item>
                  <YGroup.Item>
                    <Button
                      icon={MapPin}
                      jc="flex-start"
                      chromeless
                      width="100%"
                    >
                      To
                    </Button>
                  </YGroup.Item>
                  <YGroup.Item>
                    <Button
                      chromeless
                      jc="flex-start"
                      icon={PlusCircle}
                      width="100%"
                    >
                      Add Stop
                    </Button>
                  </YGroup.Item>
                </YGroup>
                <Button theme="green" width="100%">
                  Go!
                </Button>
              </>
            )}
          </YStack>
        </BottomSheetView>
      </BottomSheet>
    </View>
  );
}

const styles = StyleSheet.create({
  map: {
    width: "100%",
    height: "100%",
  },
});
